---

# Отчет по лабораторной работе 1 со звездочкой #
**Студенты:** Борисюк Евгений, Езиева Милана, Муравьев Матвей 

---

## Часть 1: Теоретический анализ уязвимостей конфигурации

В данной части рассматриваются теоретические аспекты ошибок конфигурации (Misconfigurations), которые были выявлены в ходе практической работы. Ошибки конфигурации веб-серверов входят в топ-лист **OWASP Top 10** и являются одной из самых частых причин взломов в облачных инфраструктурах.

### 1. Information Disclosure (Раскрытие информации о системе)
**Суть уязвимости:** Веб-сервер по умолчанию настроен на выдачу подробных сведений о себе в HTTP-заголовках ответа (параметр `Server Tokens`).
*   **Что дает злоумышленнику:** Позволяет точно определить версию ПО (например, Apache 2.4.18) и операционную систему (Ubuntu). Зная точную версию, атакующий может быстро найти специфические эксплойты под конкретные CVE (Known Vulnerabilities).
*   **Средства поиска:** `curl -I`, `nmap`, плагины браузера (например, Wappalyzer).

### 2. Directory Enumeration / Brute-force (Перебор директорий)
**Суть уязвимости:** Отсутствие ограничений на перебор путей и отсутствие защиты от автоматизированных запросов.
*   **Что дает злоумышленнику:** Позволяет составить полную карту сайта, включая скрытые страницы, административные панели и технические папки, на которые нет прямых ссылок в интерфейсе. Это расширяет «поверхность атаки».
*   **Средства поиска:** `ffuf` (Fuzz Faster U Fool), `dirb`, `gobuster`.

### 3. Sensitive Data Exposure (Раскрытие конфиденциальных данных)
**Суть уязвимости:** Хранение секретов (ключей, конфигурационных файлов, бэкапов) внутри публичной директории веб-сервера (`document root`) без ограничения доступа на уровне конфигурации Nginx/Apache.
*   **Что дает злоумышленнику:** Прямой доступ к критически важной информации. В данном случае — обнаружение папки `.ssh` и приватного ключа `id_rsa`. Это позволяет обойти механизмы аутентификации и получить удаленный доступ к консоли сервера.
*   **Средства поиска:** Автоматизированный фаззинг (`ffuf`) с использованием специализированных словарей (например, SecLists).

### 4. Broken Access Control (Нарушение контроля доступа)
**Суть уязвимости:** Ошибка в настройке прав доступа, когда технические директории (такие как `.ssh`, `.git`, `.env`) доступны для чтения из внешней сети.
*   **Что дает злоумышленнику:** Возможность несанкционированного скачивания файлов, которые предназначены только для внутреннего использования системой или администратором.
*   **Средства поиска:** Ручной аудит путей и автоматизированное сканирование.

---

## Часть 2: Инфраструктура исследования и описание платформы

Для проведения аудита безопасности была выбрана платформа **TryHackMe (THM)**. В данном разделе рассматривается архитектура платформы, технические особенности выбранной среды и обоснование её использования для выполнения лабораторной работы.

### 1. Обоснование выбора платформы
Выбор TryHackMe в качестве полигона для исследования обусловлен следующими факторами:

*   **Этичность и легальность:** Согласно заданию, использование «суперпопулярных сайтов» (Google, Яндекс) запрещено, а аудит случайных ресурсов может быть расценен как правонарушение. TryHackMe предоставляет полностью легальную среду, где владельцы ресурсов заранее дали разрешение на поиск и эксплуатацию уязвимостей.
*   **Изолированная среда (Sandbox):** Все действия проводятся в частной виртуальной сети. Это гарантирует, что учебный «взлом» не нанесет вреда реальной инфраструктуре.
*   **Реализм конфигураций:** В отличие от теоретических задач, здесь используются реальные виртуальные машины (в данном случае на базе Ubuntu), в которых допущены типичные ошибки администрирования. Это позволяет студенту столкнуться с «живыми» мисконфигурациями.

### 2. Техническое устройство платформы
TryHackMe построена на базе облачной инфраструктуры (преимущественно AWS), где по запросу пользователя разворачиваются временные экземпляры (инстансы) уязвимых машин.

*   **Игровая механика (CTF):** Платформа работает в формате **Capture The Flag** (Захват флага). Целью является не просто обнаружение ошибки, а получение доступа к скрытым текстовым файлам (флагам) — `user.txt` и `root.txt`. Это служит объективным доказательством успешного взлома.
*   **Сетевая связность:** Для взаимодействия с целью используется два способа:
    1.  **OpenVPN:** Создание зашифрованного туннеля между локальной машиной студента и сетью THM.
    2.  **AttackBox:** Собственная виртуальная машина платформы (на базе Kali Linux или Ubuntu), доступ к которой осуществляется прямо через веб-интерфейс. В данной лабораторной работе использовался **AttackBox**, так как он содержит предустановленный стек профессионального ПО для аудита.

### 3. Описание целевой лаборатории: Wgel CTF
Объектом исследования стала бесплатная комната **Wgel CTF**. Данная среда моделирует корпоративный веб-ресурс со следующими характеристиками:
*   **Операционная система:** Ubuntu 16.04.6 LTS.
*   **Веб-сервер:** Apache/2.4.18 (несмотря на то, что в задании упоминался Nginx, методы аудита и инструменты фаззинга полностью идентичны, что позволяет достичь целей лабораторной работы).
*   **Вектор атаки:** Ошибки конфигурации доступа к файловой системе и избыточные привилегии системных утилит.

### 4. Используемый инструментарий (DevOps Toolchain)
В процессе работы применялся классический стек инструментов для проведения аудита информационной безопасности:
*   **curl:** Использовался для низкоуровневого взаимодействия с веб-сервером и анализа HTTP-заголовков (Information Disclosure).
*   **ffuf (Fuzz Faster U Fool):** Инструмент на языке Go, выбранный за высокую скорость перебора. С его помощью осуществлялся поиск скрытых директорий, которые администратор планировал скрыть от обычных пользователей.
*   **nc (Netcat):** Применялся для приема данных (Exfiltration) при повышении привилегий.
*   **SSH (Secure Shell):** Использовался для удаленного управления сервером после получения скомпрометированного ключа.

---

## Часть 3: Технический анализ и эксплуатация выявленных уязвимостей

В данном разделе подробно рассматриваются 4 ключевые ошибки конфигурации, обнаруженные на сервере `10.82.176.245`. Для каждой уязвимости описан процесс поиска, полученный результат и вектор возможной атаки.

### 1. Уязвимость №1: Information Disclosure (Раскрытие версии ПО)

Первым этапом аудита стала проверка конфигурации HTTP-заголовков на предмет избыточности выдаваемой информации.

> **Рисунок 1 (использовать Скрин №1 или №5): Идентификация версии веб-сервера через curl**
> ![Анализ заголовков](img/5.jpg)

*   **Что сделано:** С помощью утилиты `curl` с флагом `-I` выполнен запрос к заголовкам сервера.
*   **Что получено:** Сервер вернул точную версию ПО — `Apache/2.4.18 (Ubuntu)`.
*   **Анализ и использование:** В профессиональной среде DevOps это считается мисконфигурацией. Раскрытие точной версии позволяет злоумышленнику быстро сопоставить её с базой известных уязвимостей (CVE) и подобрать готовый эксплойт. Например, для старых версий Apache существуют методы обхода авторизации или вызова отказа в обслуживании (DoS).

---

### 2. Уязвимость №2: Directory Enumeration (Небезопасный фаззинг директорий)

Следующим этапом стал поиск скрытых путей, которые не отображаются в интерфейсе сайта, но доступны для прямого обращения.

> **Рисунок 2 (использовать Скрин №3): Процесс обнаружения скрытой структуры через ffuf**
> ![Первичный фаззинг](img/3.jpg)

*   **Что сделано:** Проведен автоматизированный перебор (fuzzing) путей в корне сайта с помощью инструмента `ffuf` и словаря `common.txt`. Обнаружена директория `/sitemap/`.
*   **Что получено:** Доступ к разделу сервера, который не был афиширован администратором.
*   **Анализ и использование:** Отсутствие защиты от перебора позволяет злоумышленнику составить полную карту сайта. Скрытые папки часто становятся «точкой входа», так как в них могут находиться забытые бэкапы, тестовые скрипты или, как в данном случае, технические папки.

---

### 3. Уязвимость №3: Sensitive Data Exposure (Раскрытие конфиденциальных данных)

Данная уязвимость была обнаружена в ходе рекурсивного (углубленного) сканирования ранее найденных путей.

> **Рисунок 3 (использовать Скрин №2): Обнаружение папки .ssh через ffuf**
> ![Рекурсивный фаззинг](img/2.jpg)

> **Рисунок 4 (использовать Скрин №4): Получение содержимого файла id_rsa**
> ![Текст приватного ключа](img/4.jpg)

*   **Что сделано:** Проведен фаззинг внутри директории `/sitemap/`. Обнаружена системная папка `.ssh/`, из которой напрямую был скачан файл `id_rsa` через команду `curl`.
*   **Что получено:** Текст приватного SSH-ключа, являющегося цифровой подписью пользователя.
*   **Анализ и использование:** Это критическая ошибка DevOps-инженера — хранение секретов (ключей) внутри публичной директории веб-сервера (`document root`). Полученный ключ позволяет злоумышленнику полностью обойти механизмы парольной аутентификации и войти в операционную систему сервера удаленно, получив прямой доступ к файловой системе.

---

### 4. Уязвимость №4: Privilege Escalation via Sudo Misconfiguration

Финальная уязвимость была обнаружена уже внутри системы. Она связана с некорректной настройкой прав доступа к системным утилитам.

> **Рисунок 5 (использовать Скрин №7): Подготовка слушателя netcat на AttackBox**
> ![Слушатель nc](img/7.jpg)

> **Рисунок 6 (использовать Скрин №8): Эксплуатацияwget для чтения защищенных данных**
> ![Атака через wget](img/8.jpg)

*   **Что сделано:** После входа в систему был проведен аудит разрешений команды `sudo -l`. Обнаружено, что пользователю разрешено запускать `/usr/bin/wget` от имени root без пароля. Была использована функция `wget --post-file` для кражи данных.
*   **Что получено:** Возможность прочитать любой файл в системе (включая флаги администратора) и отправить его содержимое на удаленный сервер через HTTP-запрос.
*   **Анализ и использование:** Это уязвимость повышения привилегий. Легитимная утилита для скачивания файлов превращается в инструмент для кражи данных (Data Exfiltration). Для злоумышленника это означает полную компрометацию сервера: имея возможность читать любые файлы от имени root, он может похитить пароли других пользователей, конфигурации баз данных и ключи шифрования всей компании.


